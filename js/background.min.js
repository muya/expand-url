function sendMessageToTab(e,r){chrome.tabs.create({url:chrome.extension.getURL("preview.html"),index:r.origTabIndex+1},function(e){r.openedTabID=e.id,chrome.tabs.sendMessage(e.id,r)})}chrome.contextMenus.onClicked.addListener(function(e,r){chrome.storage.sync.get("open_expanded_url_action",function(n){if(void 0!==chrome.runtime.lastError)return void sendMessageToTab(r.id,{error:chrome.i18n.getMessage("previewDefaultError"),originalTabID:r.id,origTabIndex:r.index});void 0===n.open_expanded_url_action&&(n.open_expanded_url_action=Config.default_expand_url_action);var o=n.open_expanded_url_action;"preview"===o?sendMessageToTab(r.id,{originalTabID:r.id,origTabIndex:r.index,clickedUrl:e.linkUrl}):$.ajax({type:"POST",url:Config.expand_url_api,data:{shortUrl:e.linkUrl},success:function(e){if($("#translateToImg").remove(),void 0===e.status)return void sendMessageToTab(r.id,{error:chrome.i18n.getMessage("unableToResolveUrl"),originalTabID:r.id,origTabIndex:r.index});if(1===e.status){var n=e.data.expandedUrl;return void chrome.tabs.create({url:n})}sendMessageToTab(r.id,{error:chrome.i18n.getMessage("unableToResolveUrl"),originalTabID:r.id,origTabIndex:r.index})}})})}),chrome.contextMenus.create({id:"open_context_menu",type:"normal",title:chrome.i18n.getMessage("context_menu_title"),contexts:["link"]},function(){console.error("got this error: "+chrome.runtime.lastError.message)});